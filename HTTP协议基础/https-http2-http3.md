### 根基

### 密码学
- 密码学处理对象是数字和字符串
- 散列是一种数据一旦转换为其他形式将永远没办法恢复的加密技术
- 加密
    - 对称加密（AEC、DES、3DES）
    - 非对称加密（RSA）
- 密钥交换算法
1. A与B确定两个大素数n和g,这两个数不用保密
2. A选择另一个大随机数x，并计算A1如下：a = gx%n
3. A将a发送给B
4. B选择另一个大随机数y,并计算B如下：b = gy%n
5. B将b发送给A
6. A计算秘密密钥K1如下：K1 = bx%n
7. B计算秘密密钥K2如下：K2 = ay%n
8. 如果K1===K2.那么可以正常加解密


### CA
- 通过CA发放的证书完成密钥的交换，实际上就是利用非对称加密算法完成数据加密密钥的安全交换，然后利用数据加密密钥完成数据的安全交换
- 数字证书：数字证书是互联网通信中标识双方身份的数字文件：由CA签发
- CA:CA（certification authority）是数字证书的签发机构，作为权威机构，其审核申请身份后就会签发证书这样只需要校验数字证书即可确认对方真实身份

CA的工作流程
1. 服务器从CA请求TLS证书，例如Digicert ,Symantec
2. CA机构为服务器创建证书，证书包含服务器名称，服务器公钥等
3. CA给证书创建hash值，并使用自己的私钥进行加密。 （防止证书被伪造）
4. 浏览器和操作系统内置的证书（公钥），浏览器开发商和操作系统开发商一般会内置一些比较权威的CA签发机构的证书
5. 当浏览器收到签名证书的时候，他使用公钥从签名中生成hash值，它将使用证书中制定的散列算法生成数据（证书）的散列，如果两个哈希值匹配，则签名验证成功并且证书是可信的
6. 浏览器在使用证书中的另一个专门的服务器公钥来进行身份的验证
7. Digicert被称为root CA,在验证签名的时候，除了子机构的签名验证，也要验证根机构的有效性


### SSL/TLS协议
- 传输层安全性协议（Transfer Layer Security）,及前身安全套接字协议（Security sockets layer）是一种安全协议，目的是为互联网通信提供安全及数据完整性保障
- HTTPS协议的安全性由SSL协议实现，当前使用的TLS协议1.2版本包含了四个核心子协议：握手协议，密钥配置切换协议，应用数据协议及报警协议 
    1. TLS使用于对称加密（这里服务器需要知道浏览器所使用的加密密钥，同理客户端也需要知道，这个时候就依赖于密钥交换算法。这是相对安全的，不安全的地方就是中间人攻击）
    2. 对称密钥可以通过安全密钥交换算法共享
    3. 使用数字签名进行身份验证
    4. 证书颁发机构和信任链（根CA->子CA->证书）


### HTTPS协议分析

#### TLS握手的步骤

1. ClientHello:客户端发送所支持的SSL/TLS最高版本协议号和所支持的加密算法集合及压缩方法集合等信息给服务器端
2. ServerHello:服务器收到客户端信息后，选定双方都能够支持的SSL/TLS协议版本和加密方法及压缩方法
3. SendCertificate(可选)：服务器发送服务器证书给客户端
4. RequestCertificate(可选)：如果选择双向验证，服务器向客户端请求客户端证书
5. ServerHelloDone(可选)：服务端通知客户端初始协商结束
6. ResponseCertificate(可选)：如果选择双向验证，客户端向服务器端发送客户端证书
7. ClientKeyExchange：客户端使用服务服务端的公钥，对客户端公钥和密钥种子进行加密，在发送给服务端
8. CertificateVertify(可选)：如果选择双向验证，客户端用本地私钥生成数字签名，并发送给服务端，让其通过收到的客户端公钥进行身份验证
9. CreateSecretKey：通信双方基于密钥种子等信息生成通信密钥
10. ChangeCipherSpec: 客户端通知服务端已将通信方法切换到加密模式
11. Finished：客户端做好加密通信的准备
12. ChangeCipherSpec：服务端通知客户端已将通信方法切换到加密模式
13. Finished: 服务器已做好加密通信的准备
14. Encrypted/DecrytedData：双方使用客户端密钥，通过对称加密算法对通信内容进行加密
15. ClosedConnection 通信结束后，任何一方发出断开SSL连接的消息